<script>
  let scenarioInfos = {{built_in_scenarios | tojson}};
  function togglePreBuiltDiv() {
    document.getElementById("preBuiltDiv").hidden = false
    document.getElementById("ctFileDiv").hidden = true
  }

  function toggleCTFileDiv() {
    document.getElementById("preBuiltDiv").hidden = true
    document.getElementById("ctFileDiv").hidden = false
  }

  function valueChanged() {
    let hasError = false
    if (!validateTargetValues()){
      hasError = true
    } else if (!validateDisplayValues()){
      hasError = true
    } else if(!validateSimulationSettingsValues()) {
      hasError = true
    } else if (!validateMaterialValues()){
      hasError = true
    }

    if (hasError){
      disallowRunSimulation()
      clearPlotArea()
    } else {
      renderLayout()
    }
  }

  function scenarioSelected(scenarioInput){
    clearPlotArea()

    const selection = scenarioInput.value;
    if (selection===""){
      disallowRunSimulation()
      disallowRenderLayout()
      clearAllTransducers()
      document.getElementById("parameters-form").reset()
      return;
    }
    const selectedScenario = scenarioInfos[selection]
    setScenarioValues(selectedScenario)
    renderLayout()
    allowViewScenarioParameters()
  }

  function setScenarioValues(scenario){
    setTargetValues(scenario.target)
    setSimulationSettingsValues(scenario.simulationSettings)
    setTransducersValues(scenario.transducers)
    if (!scenario.is2d){
      setDisplayValues(scenario.displaySettings)
    }
  }

  function getScenarioParams() {
    const isPreBuilt = document.getElementById("isPreBuilt").checked
    let params = {
      isPreBuilt: isPreBuilt,
    }
    if (isPreBuilt) {
      params["scenarioId"] = document.getElementById("scenario").value
    } else {
      params["ctFile"] = document.getElementById("ctFile").value
    }
    return params
  }

  function setScenariosOptions(is2d){
    const scenarioSelect = document.getElementById("scenario")
    scenarioSelect.innerHTML = ""

    const option = document.createElement("option")
    option.value = ""
    option.text = "Select a scenario"
    scenarioSelect.appendChild(option)

    for (const [scenarioId, scenario] of Object.entries(scenarioInfos)) {
      if (scenario.is2d === is2d) {
        const option = document.createElement("option")
        option.value = scenarioId
        option.text = scenario.title
        scenarioSelect.appendChild(option)
      }
    }
  }
</script>
<form>
  <div class="mb-3">
    <div class="btn-group">
      <input
        type="radio"
        class="btn-check"
        name="options"
        id="isPreBuilt"
        autocomplete="off"
        onchange="togglePreBuiltDiv()"
        checked
      />
      <label
        class="btn btn-primary"
        for="isPreBuilt"
        data-bs-toggle="tooltip"
        data-bs-placement="right"
        title="Use a prebuilt scenario with a target and transducers"
        >Prebuilt</label
      >

      <input
        type="radio"
        class="btn-check"
        name="options"
        id="isCtScan"
        autocomplete="off"
        onchange="toggleCTFileDiv()"
        disabled
      />
      <label
        class="btn btn-primary"
        for="isCtScan"
        data-bs-toggle="tooltip"
        data-bs-placement="right"
        title="Load a CT scan from a file"
        >CT Scan</label
      >
    </div>
  </div>

  <div class="mb-3">
    <div id="preBuiltDiv">
      <label for="scenario" class="form-label">Scenarios:</label>
      <select
        name="scenario"
        id="scenario"
        class="form-select"
        onchange="scenarioSelected(this)"
      ></select>
    </div>
    <div id="ctFileDiv" hidden>
      <label for="ctFile" class="form-label" for="ctFile">CT File</label>
      <input class="form-control" type="file" id="ctFile" />
    </div>
  </div>
</form>
